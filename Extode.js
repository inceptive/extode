/*
 * Copyright(c) 2011 Aron Homberg and the extode Community.
 * http://extode.jsyn.de
 */
/*
 * Extify - runs everywhere
 * 
 * High performance, ultra-minimal, opensource OOP javascript framework in style 
 * of Ext Core. Reimplements portions of the Ext Core 3.1 and Ext JS 4 API 
 * in a clean way. Extify is MIT licensed.
 *  
 * USED PORTIONS OF:
 * 
 * Ext Core Library 3.1
 * http://extjs.com/
 * Copyright(c) 2006-2009, Ext JS, LLC.
 * 
 * MIT Licensed - http://extjs.com/license/mit.txt
 *
 * The MIT License
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
if(typeof GLOBAL!=="undefined"){window=global=GLOBAL}else{if(typeof window!=="undefined"){window=global=GLOBAL=window}else{window=global=GLOBAL=window=this}}Ext={enableLogging:true,USE_NATIVE_JSON:true,version:"4.0.0",frameworkName:"Extify"};Ext.apply=function(d,e,b){if(b){Ext.apply(d,b)}if(d&&e&&typeof e=="object"){for(var a in e){if(true){d[a]=e[a]}}}return d};(function(){var toString=Object.prototype.toString;Ext.apply(Ext,{enableLogging:true,LOGLEVEL_WARN:"warn",LOGLEVEL_INFO:"info",LOGLEVEL_DEBUG:"debug",_log:function(logMessage){var severity=Ext.LOGLEVEL_INFO,toLog=[];if(Ext.isDefined(arguments[1])){severity=arguments[1]}toLog.push(Ext.frameworkName+"["+severity+"]:");for(var i=0;i<logMessage.length;i++){toLog.push(logMessage[i])}if(Ext.enableLogging===true){try{console.log.apply(this,toLog)}catch(e){console.log(toLog)}}},log:function(){Ext._log(arguments,Ext.LOGLEVEL_DEBUG)},info:function(){Ext._log(arguments,Ext.LOGLEVEL_INFO)},debug:function(){Ext._log(arguments,Ext.LOGLEVEL_DEBUG)},warn:function(){Ext._log(arguments,Ext.LOGLEVEL_WARN)}});global.log=Ext.log;global.warn=Ext.warn;global.debug=Ext.debug;global.dir=Ext.log;global.alert=Ext.warn;global.info=Ext.info;Ext.apply(Ext,{applyIf:function(o,c){if(o){for(var p in c){if(!Ext.isDefined(o[p])){o[p]=c[p]}}}return o},extend:function(){var io=function(o){for(var m in o){if(this){this[m]=o[m]}}};var oc=Object.prototype.constructor;return function(sb,sp,overrides){if(!Ext.isDefined(sb)||!Ext.isDefined(sp)){return null}if(Ext.isObject(sp)){overrides=sp;sp=sb;sb=overrides.constructor!=oc?overrides.constructor:function(){sp.apply(this,arguments)}}var F=function(){},sbp,spp=sp.prototype;F.prototype=spp;sbp=sb.prototype=new F();sbp.constructor=sb;sb.superclass=spp;if(spp.constructor==oc){spp.constructor=sp}sb.override=function(o){Ext.override(sb,o)};sbp.superclass=sbp.supr=(function(){return spp});sbp.override=io;Ext.override(sb,overrides);sb.extend=function(o){return Ext.extend(sb,o)};return sb}}(),define:function(){var nameOfClass=arguments[0],classDef=arguments[1],cb=arguments[2],superClassRef=Object,i,mName=null,currentMixRef={},clsProto;if(!Ext.isDefined(nameOfClass)){throw"Error: Please specify a class name when using Ext.define()!"}if(!Ext.isDefined(classDef)){throw"Error: Please provide a class definition object for class '"+nameOfClass+"' when using Ext.define()!"}if(!Ext.isDefined(cb)){cb=function(){}}if(!Ext.isDefined(classDef.extend)){classDef.extend="Ext.Class"}if(Ext.isDefined(classDef.extend)){var clsNotPresentErr="Error: The class '"+classDef.extend+"' the class '"+nameOfClass+"' should extend from isn't present.";try{superClassRef=eval("("+classDef.extend+")");if(!Ext.isDefined(superClassRef)){throw clsNotPresentErr}}catch(e){throw clsNotPresentErr}}if(Ext.isDefined(classDef.mixins)&&Ext.isArray(classDef.mixins)){for(i=0;i<classDef.mixins.length;i++){try{currentMixRef=eval("("+classDef.mixins[i]+")")}catch(e){throw"Error: The class '"+classDef.mixins[i]+"' you want to mixin in '"+nameOfClass+"' is not present."}if(Ext.isDefined(currentMixRef)&&Ext.isFunction(currentMixRef)){delete currentMixRef.prototype.constructor;Ext.apply(classDef,currentMixRef.prototype)}}}for(mName in classDef){if(Ext.isFunction(classDef[mName])){classDef[mName]["$name"]=mName}}clsProto=Ext.extend(superClassRef,classDef);clsProto.prototype["$superclass"]=superClassRef;if(clsProto==null){throw"The class definition of class named "+nameOfClass+" failed. Maybe the inheritance function references are undefined."}if(Ext.isDefined(classDef.singleton)&&classDef.singleton===true){clsProto=new clsProto()}for(name in classDef.statics){clsProto[name]=Ext.Function.bind(classDef.statics[name],clsProto)}var nameRef=function(name,ref){var scope,splits=name.split("."),len=splits.length;if(len==1){scope=window[splits[0]]=ref;return scope}else{scope=window[splits[0]]=window[splits[0]]||{}}var splitIter=1;Ext.each(splits.slice(1),function(nameSplit){splitIter++;if(len==splitIter){scope=scope[nameSplit]=ref}else{scope=scope[nameSplit]=scope[nameSplit]||{}}});return scope};nameRef(nameOfClass,clsProto);if(Ext.isDefined(classDef.alias)){nameRef(classDef.alias,clsProto)}cb(clsProto);return clsProto},create:function(className,instOverlay){var splits=className.split("."),len=splits.length,i,prevRef=window,inst;for(i=0;i<len;i++){prevRef=prevRef[splits[i]];if(!Ext.isDefined(prevRef)||prevRef==null){throw"The class you want to instantiate is not defined: "+className}}if(!Ext.isDefined(instOverlay)||!Ext.isObject(instOverlay)){instOverlay={}}if(!Ext.isFunction(prevRef)){throw"The given class name "+className+" is not of type function (not a constructor!)"}return new prevRef(instOverlay)},each:function(array,fn,scope){if(Ext.isEmpty(array,true)){return}if(Ext.isPrimitive(array)){array=[array]}for(var i=0,len=array.length;i<len;i++){if(fn.call(scope||array[i],array[i],i,array)===false){return i}}},override:function(origclass,overrides){if(overrides){var p=origclass.prototype;Ext.apply(p,overrides)}},namespace:function(){var o,d;Ext.each(arguments,function(v){d=v.split(".");o=window[d[0]]=window[d[0]]||{};Ext.each(d.slice(1),function(v2){o=o[v2]=o[v2]||{}})});return o},urlAppend:function(url,s){if(!Ext.isEmpty(s)){return url+(url.indexOf("?")===-1?"?":"&")+s}return url},isIterable:function(v){if(Ext.isArray(v)||v.callee){return true}},iterate:function(obj,fn,scope){if(Ext.isEmpty(obj)){return}if(Ext.isIterable(obj)){Ext.each(obj,fn,scope);return}else{if(Ext.isObject(obj)){for(var prop in obj){if(obj.hasOwnProperty(prop)){if(fn.call(scope||obj,prop,obj[prop],obj)===false){return}}}}}},toArray:function(){return function(a,i,j){return Array.prototype.slice.call(a,i||0,j||a.length)}}(),isEmpty:function(v,allowBlank){return v===null||v===undefined||((Ext.isArray(v)&&!v.length))||(!allowBlank?v==="":false)},isArray:function(v){return toString.apply(v)==="[object Array]"},isDate:function(v){return toString.apply(v)==="[object Date]"},isObject:function(v){return !!v&&Object.prototype.toString.call(v)==="[object Object]"},isPrimitive:function(v){return Ext.isString(v)||Ext.isNumber(v)||Ext.isBoolean(v)},isFunction:function(v){return toString.apply(v)==="[object Function]"},isNumber:function(v){return typeof v==="number"&&isFinite(v)},isString:function(v){return typeof v==="string"},isBoolean:function(v){return typeof v==="boolean"},isDefined:function(v){return typeof v!=="undefined"},idSequence:0,id:function(){Ext.idSequence++;return"ext-"+Ext.idSequence}})})();Ext.ns=Ext.namespace;Ext.ns("Ext.util","Ext.lib","Ext.data");Ext.define("Ext.util.Serializable",{extend:"Object",serialize:function(){return Ext.encode(this)}});Ext.define("Ext.util.ClassObservable",{extend:"Object",eventNames:[],listenersMap:{},listeners:{},processListenersObject:function(){for(eventName in this.listeners){this.on(eventName,this.listeners[eventName])}},fireEvent:function(h){var d=false,g=null,b=false,a=false,f=false;if(Ext.Array.indexOf(this.eventNames,h)<0){throw"The event with name "+h+" cannot be fired. It wasn't added before. (@see addEvents(...))."}var c=[];for(index in arguments){if(index>0){c.push(arguments[index])}}for(var e=0;e<this.listenersMap[h].length;e++){if(Ext.isDefined(this.listenersMap[h][e])){d=false;b=false;a=false;f=false;g=this.listenersMap[h][e].additionalOpts;if(Ext.isDefined(g)&&Ext.isObject(g)){if(Ext.isDefined(g.single)&&g.single===true){d=true}if(Ext.isDefined(g.delay)&&Ext.isNumber(g.delay)){b=true}if(Ext.isDefined(g.buffer)&&Ext.isNumber(g.buffer)){a=true}if(Ext.isDefined(g.target)&&Ext.isNumber(g.target)){f=true}}if(Ext.isDefined(this.listenersMap[h][e].$singleWasExecuted)){return}if(f===true){if(g.target!==this){return}}if(b===true){setTimeout(Ext.Function.bind(function(){this.listenersMap[h][e].apply(this,c)},this),g.delay)}else{if(a===true){if(Ext.isDefined(this.listenersMap[h][e].$bufferTimestamp)&&Ext.isDate(this.listenersMap[h][e].$bufferTimestamp)){if(((this.listenersMap[h][e].$bufferTimestamp.getTime()+g.buffer)-new Date().getTime())>0){this.listenersMap[h][e].apply(this,c);delete this.listenersMap[h][e].$bufferTimestamp}}else{this.listenersMap[h][e].$bufferTimestamp=new Date();return}}else{this.listenersMap[h][e].apply(this,c)}}if(d){this.listenersMap[h][e].$singleWasExecuted=true}}}},trigger:function(a){this.fireEvent.apply(this,arguments)},addEvents:function(){if(Ext.isDefined(arguments[0])&&Ext.isArray(arguments[0])){throw"Don't use array as input. Just provide a lot of event names in sequence!"}for(var a=0;a<arguments.length;a++){this.eventNames.push(arguments[a]);this.listenersMap[arguments[a]]=[]}},addListener:function(f,c,a){var b=function(h,g,e){g.additionalOpts=e;this.listenersMap[h].push(g)};try{b.call(this,f,c,a)}catch(d){this.addEvents(f);b.call(this,f,c,a)}},on:function(c,b,a){return this.addListener(c,b,a)},bind:function(c,b,a){return this.addListener(c,b,a)},relayEvents:function(clsInst,eventNames){var me=this,execScope=null;if(Ext.isDefined(clsInst.addEvents)&&Ext.isFunction(clsInst.addEvents)){me.addEvents(eventNames);for(var i=0;i<eventNames.length;i++){execScope={};execScope.me=me;execScope._eventName=eventNames[i];execScope._clsInst=clsInst;with(execScope){_clsInst.on(_eventName,function(){debug("Relayed event EXPERIMENTAL fired:");debug(_eventName);debug("Relayed event EXPERIMENTAL fired:");me.fireEvent(_eventName,arguments)})}}}},removeListener:function(d,b){var a,c;for(a in this.listenersMap){for(c=0;c<this.listenersMap[a].length;c++){if(Ext.isDefined(d)&&Ext.isString(d)){if(d===a){if(Ext.isDefined(b)&&Ext.isFunction(b)){if(this.listenersMap[a][c]===b){this.listenersMap[a]=Ext.Array.remove(this.listenersMap[a],this.listenersMap[a][c])}}else{this.listenersMap[a]=Ext.Array.remove(this.listenersMap[a],this.listenersMap[a][c])}}}else{this.listenersMap[a]=Ext.Array.remove(this.listenersMap[a],this.listenersMap[a][c])}}}},un:function(a){this.removeListener.apply(this,arguments)},unbind:function(a){this.removeListener.apply(this,arguments)}});Ext.define("Ext.Class",{mixins:["Ext.util.ClassObservable","Ext.util.Serializable"],extend:"Object",id:null,constructor:function(){if(Ext.isDefined(arguments[0])&&Ext.isObject(arguments[0])){Ext.apply(this,arguments[0])}Ext.Instances.push(this);this.processListenersObject()},callParent:function(a){var b=this.callParent.caller;if(!Ext.isDefined(b)){throw"callParent() failed. Caller not found."}if(!Ext.isDefined(this.constructor.prototype.$superclass.prototype)){throw"callParent() failed. There is no superclass that could be referred to."}if(!Ext.isDefined(this.constructor.prototype.$superclass.prototype[b.$name])||!Ext.isFunction(this.constructor.prototype.$superclass.prototype[b.$name])){throw"callParent() failed. There is no parent method (function) named "+b.$name+" in superclass."}else{this.constructor.prototype.$superclass.prototype[b.$name].apply(this,a||[])}}},function(){if(!Ext.isDefined(Ext.Instances)){Ext.Instances=[]}});Ext.apply(Function.prototype,{createInterceptor:function(b,a){var c=this;return !Ext.isFunction(b)?this:function(){var e=this,d=arguments;b.target=e;b.method=c;return(b.apply(a||e||window,d)!==false)?c.apply(e||window,d):null}},createCallback:function(){var a=arguments,b=this;return function(){return b.apply(window,a)}},createDelegate:function(c,b,a){var d=this;return function(){var f=b||arguments;if(a===true){f=Array.prototype.slice.call(arguments,0);f=f.concat(b)}else{if(Ext.isNumber(a)){f=Array.prototype.slice.call(arguments,0);var e=[a,0].concat(b);Array.prototype.splice.apply(f,e)}}return d.apply(c||window,f)}},defer:function(c,e,b,a){var d=this.createDelegate(e,b,a);if(c>0){return setTimeout(d,c)}d();return 0}});Ext.define("Ext.Function",{singleton:true,createInterceptor:function(b,c,a){var d=b;return !Ext.isFunction(c)?this:function(){var f=this,e=arguments;c.target=f;c.method=d;return(c.apply(a||f||window,e)!==false)?d.apply(f||window,e):null}},createCallback:function(b){var a=Array.prototype.slice.call(arguments,1);method=b;return function(){return method.apply(window,a)}},bind:function(c,d,b,a){var e=c;return function(){var g=b||arguments;if(a===true){g=Array.prototype.slice.call(arguments,0);g=g.concat(b)}else{if(Ext.isNumber(a)){g=Array.prototype.slice.call(arguments,0);var f=[a,0].concat(b);Array.prototype.splice.apply(g,f)}}return e.apply(d||window,g)}},defer:function(d,c,e,b,a){var d=Ext.Function.createDelegate(e,b,a);if(c>0){return setTimeout(d,c)}d();return 0}});Ext.applyIf(String,{format:function(b){var a=Ext.toArray(arguments,1);return b.replace(/\{(\d+)\}/g,function(c,d){return a[d]})}});Ext.define("Ext.String",{singleton:true,format:function(b){var a=Ext.toArray(arguments,1);return b.replace(/\{(\d+)\}/g,function(c,d){return a[d]})}});Ext.applyIf(Array.prototype,{indexOf:function(b,c){var a=this.length;c=c||0;c+=(c<0)?a:0;for(;c<a;++c){if(this[c]===b){return c}}return -1},remove:function(b){var a=this.indexOf(b);if(a!=-1){this.splice(a,1)}return this}});Ext.define("Ext.Array",{singleton:true,indexOf:function(b,c,d){var a=b.length;d=d||0;d+=(d<0)?a:0;for(;d<a;++d){if(b[d]===c){return d}}return -1},remove:function(a,c){var b=a.indexOf(c);if(b!=-1){a.splice(b,1)}return a}});Ext.Template=function(e){var d=this,b=arguments,c=[];if(Ext.isArray(e)){e=e.join("")}else{if(b.length>1){Ext.each(b,function(a){if(Ext.isObject(a)){Ext.apply(d,a)}else{c.push(a)}});e=c.join("")}}d.content=e;if(d.compiled){d.compile()}};Ext.Template.prototype={re:/\{([\w-]+)\}/g,applyTemplate:function(a){var b=this;return b.compiled?b.compiled(a):b.content.replace(b.re,function(c,d){return a[d]!==undefined?a[d]:""})},set:function(b,c){var a=this;a.content=b;a.compiled=null;return c?a.compile():a},compile:function(){var me=this,sep="+";function fn(m,name){name="values['"+name+"']";return"'"+sep+"("+name+" == undefined ? '' : "+name+")"+sep+"'"}eval("this.compiled = function(values){ return "+("'")+me.content.replace(/\\/g,"\\\\").replace(/(\r\n|\n)/g,"\\n").replace(/'/g,"\\'").replace(this.re,fn)+("';};"));return me}};Ext.Template.prototype.apply=Ext.Template.prototype.applyTemplate;Ext.util.TaskRunner=function(e){e=e||10;var f=[],a=[],b=0,g=false,d=function(){g=false;clearInterval(b);b=0},h=function(){if(!g){g=true;b=setInterval(i,e)}},c=function(j){a.push(j);if(j.onStop){j.onStop.apply(j.scope||j)}},i=function(){var l=a.length,n=new Date().getTime();if(l>0){for(var p=0;p<l;p++){f.remove(a[p])}a=[];if(f.length<1){d();return}}for(var p=0,o,k,m,j=f.length;p<j;++p){o=f[p];k=n-o.taskRunTime;if(o.interval<=k){m=o.run.apply(o.scope||o,o.args||[++o.taskRunCount]);o.taskRunTime=n;if(m===false||o.taskRunCount===o.repeat){c(o);return}}if(o.duration&&o.duration<=(n-o.taskStartTime)){c(o)}}};this.start=function(j){f.push(j);j.taskStartTime=new Date().getTime();j.taskRunTime=0;j.taskRunCount=0;h();return j};this.stop=function(j){c(j);return j};this.stopAll=function(){d();for(var k=0,j=f.length;k<j;k++){if(f[k].onStop){f[k].onStop()}}f=[];a=[]}};Ext.TaskMgr=new Ext.util.TaskRunner();Ext.util.DelayedTask=function(d,c,a){var e=this,f,b=function(){clearInterval(f);f=null;d.apply(c,a||[])};e.delay=function(h,j,i,g){e.cancel();d=j||d;c=i||c;a=g||a;f=setInterval(b,h)};e.cancel=function(){if(f){clearInterval(f);f=null}}};Ext.define("Ext.Registry",{singleton:true,set:function(a,b){global.registry[a]=b},get:function(a){return global.registry[a]},isset:function(a){if(global.registry[a]){return true}return false}});global.registry={};Ext.apply(Ext,{frameworkName:"Extode",appDirPath:__dirname,appConfig:{isDefault:true},loadClassesByNames:function(c,b){for(var a=0;a<c.length;a++){Ext.require(b+"/"+c[a]+".js")}},require:function(c,a){var b=require(c);if(Ext.isDefined(a)&&Ext.isFunction(a)){a(b)}return b},setAppDir:function(a){Ext.appDirPath=a},getAppDir:function(){return Ext.appDirPath},decode:function(a){return JSON.parse(a)},encode:function(a){return JSON.stringify(a)},getApp:function(){return global.App},getAppConfig:function(){if(!Ext.isDefined(Ext.appConfig)||!Ext.isObject(Ext.appConfig)||Ext.isDefined(Ext.appConfig.isDefault)){Ext.warn("Application confiugration is wasn't loaded correctly. Ensure config/development.js is existing and contains a valid app config!")}return Ext.appConfig},headScripts:function(){var b=Ext.getAppConfig(),d=b.hostname||"localhost",c=b.ioPort||1084,a=b.expressPort||80;return'<!-- Initial <head> scripts rendered dynamically by Extode.renderInitHeadScripts() --><script type="text/javascript">window.Extode = {readyFns: []}; Extode.onReady = function(cb) { Extode.readyFns.push(cb); if (Extode._isReady) { Extode.isReady(); } };<\/script><script type="text/javascript" src="http://'+d+":"+c+'/socket.io/socket.io.js"><\/script><script type="text/javascript">Extode.socket = io.connect("http://'+d+":"+c+'/"); Extode.getSocket = function() { return Extode.socket }; <\/script><script type="text/javascript" src="http://'+d+":"+a+'/Extode/__PartialSupport__.js"><\/script><script type="text/javascript">Extode._isReady = false; Extode.isReady = function() { for (var i=0; i<Extode.readyFns.length; i++) { Extode.readyFns[i](); } Extode._isReady = true; Extode.readyFns = []; }; Extode.isReady();<\/script>'}});global.Extode=Ext;Ext.define("Ext.Template",{singleton:true,render:function(b,c,a){return global.App.ejs.render(b||"",{locals:c||{},open:"<ejs>",close:"</ejs>",filename:a||"",scope:global})},renderFile:function(c,e){var a=global.App.fs,d="",b,c=global.App.getWebFolderPath()+"/"+c;b=a.statSync(c);if(b.isFile()){return Ext.Template.render(a.readFileSync(c,"binary"),e||{})}else{Ext.warn("[Ext.Template] File to render is not a file or not existing: "+c);return""}},renderPartial:function(d,a,b,c){return"<script type='text/javascript'>Extode.addPartialExec(function() {if (typeof Extode == 'undefined' || Extode.socket == 'undefined') {throw 'Extode.socket needs to initialized in <head>. Just insert the code: <%- Extode.renderInitHeadScripts() %> there!';} else {Extode.socket.emit('getpartial', {domId: '"+d+"',filename: '"+a+"',options: "+JSON.stringify(b)+",vars: "+JSON.stringify(c)+"});}});<\/script>"}});Ext.define("Ext.app.Helper",{mixins:["Ext.util.ClassObservable"],statics:{create:function(a){if(typeof global.Helpers=="undefined"){global.Helpers={}}return global.Helpers[a.name]=new Ext.app.Helper(a)},get:function(a){return global.Helpers[a]}},name:"",constructor:function(a){Ext.apply(this,a);this.init()},getApp:function(){return global.App}});Ext.helper=Ext.app.Helper.create;Ext.getHelper=Ext.app.Helper.get;Ext.define("Ext.Servlet",{singleton:true,indexFile:"index.ejs",dispatchStaticFiles:function(g,d){var f=this,a=global.App.fs,b=global.App.getWebFolderPath(),c=g.params[0],e="";if(c.length===0){c=Ext.Servlet.indexFile}e=Ext.appDirPath+"/"+b+"/"+c;log("TARGET: "+e);a.stat(e,function(i,h){if(i){if(i.code==="ENOENT"){Ext.Servlet.on404(g,d)}else{Ext.Servlet.on500(g,d)}}else{Ext.Servlet.deliverFile(g,d,e,a)}});delete b,c,e},on404:function(b,a){a.send(404)},on500:function(b,a){a.send(500)},deliverFile:function(i,h,b,f){var j=global.App.mime.lookup(b),a=b.split("."),a=a[a.length-1],c=f.readFileSync(b,"binary"),d=200;if(a==="ejs"||a==="ejson"){j="text/html";try{c=Ext.Template.render(c,{App:global.App,Request:i,Response:h,Ext:Ext})}catch(g){d=500;c="Template error: "+g.message}if(a==="ejson"){j="application/json"}}h.writeHead(d,{"Content-Type":j});h.write(c,"binary");h.end();delete j,c,a,d}});Ext.define("Ext.app.Service",{mixins:["Ext.util.ClassObservable"],statics:{create:function(a){if(typeof global.Services=="undefined"){global.Services={}}return global.Services[a.name]=a},get:function(a){return global.Services[a]}},name:"",constructor:function(a){Ext.apply(this,a);this.init()},init:function(){},handle:function(a){var d=this,c=function(f,e){if(Ext.isDefined(f)&&Ext.isString(f)&&Ext.isDefined(e)&&Ext.isFunction(e)){global.App.getSocket().on(f,Ext.Function.bind(e,d))}else{throw"You need to specify an event name and a callback function for every event you want to handle. Currently given: eventName: "+f+" and as function: "+e}},b;if(Ext.isObject(a)){for(b in a){c(b,a[b])}}else{c(a,arguments[1])}},emit:function(b,a){global.App.getSocket().emit(b,a)},getApp:function(){return global.App}});Ext.service=Ext.app.Service.create;Ext.getService=Ext.app.Service.get;Ext.define("Ext.service.Partial",{extend:"Ext.app.Service",name:"Partial",statics:{getPartialWebSupportScript:function(){return Ext.String.format("Extode.partialExecs = [];Extode.hasRegisteredPartialRenderer = false;Extode.addPartialExec = function(fn) {    if (!Extode.hasRegisteredPartialRenderer) {        Extode.registerPartialRenderer();    }    fn();};Extode.registerPartialRenderer = function() {    Extode.hasRegisteredPartialRenderer = true;    Extode.socket.on('partial', function(partial) {        var targetEl = document.getElementById(partial.domId);        if (typeof targetEl != 'undefined' && targetEl !== null) {            targetEl.innerHTML = partial.html;        }    });}")}},init:function(){Ext.debug("Start Partial service");this.handle({getpartial:this.onGetPartial})},onGetPartial:function(a){this.emit("partial",{domId:a.domId,options:a.options,html:"Should deliver partial with path: "+a.filename+" :-) and info: "+JSON.stringify(a.vars)})}});Ext.define("Ext.app.Servlet",{mixins:["Ext.util.ClassObservable"],statics:{create:function(a){if(typeof global.Servlets=="undefined"){global.Servlets={}}return global.Servlets[a.name]=new Ext.app.Servlet(a)},get:function(a){return global.Servlets[a]}},name:"",constructor:function(a){Ext.apply(this,a);this.init()},init:function(){},handle:function(d,c,b){var a=global.App.getExpress();return a[d.toLowerCase()](c,b)},respond:function(a,b){a.send(b)},getApp:function(){return global.App}});Ext.servlet=Ext.app.Servlet.create;Ext.getServlet=Ext.app.Servlet.get;Ext.define("Ext.app.Model",{mixins:["Ext.util.ClassObservable"],statics:{create:function(a){if(typeof global.Models=="undefined"){global.Models={}}return global.Models[a.name]=new Ext.app.Model(a)},get:function(a){return global.App.mongoose.model(a)}},name:"",pre:{},post:{},schema:{},constructor:function(a){Ext.apply(this,a);this.defineModel()},defineModel:function(){var Schema=global.App.mongoose.Schema,fieldName=null,preName=null,postName=null;for(fieldName in this.schema){if(Ext.isString(this.schema[fieldName])){this.schema[fieldName]=global.App.mongoose.Schema[this.schema[fieldName]]||eval(this.schema[fieldName])}if(Ext.isObject(this.schema[fieldName])&&Ext.isDefined(this.schema[fieldName].type)){this.schema[fieldName].type=global.App.mongoose.Schema[this.schema[fieldName].type]||eval(this.schema[fieldName].type)}}this.schema=new Schema(this.schema,{collection:this.name});for(preName in this.pre){this.schema.pre(preName,this.pre[preName])}for(postName in this.post){this.schema.post(postName,this.post[postName])}global.App.mongoose.model(this.name,this.schema,this.name)},getSchema:function(){return this.schema},getApp:function(){return global.App}});Ext.model=Ext.app.Model.create;Ext.getModel=Ext.app.Model.get;Ext.define("Ext.app.Config",{mixins:["Ext.util.ClassObservable"],statics:{create:function(a){if(typeof global.Configs=="undefined"){global.Configs={}}Ext.appConfig=a;return global.Configs[a.name]=a},get:function(a){return global.Configs[a]}},name:"",constructor:function(a){Ext.apply(this,a);this.init()},init:function(){},getApp:function(){return global.App}});Ext.appConfig=Ext.app.Config.create;Ext.getAppConfig=Ext.app.Config.get;Ext.define("Ext.app.Application",{mixins:["Ext.util.ClassObservable"],statics:{create:function(a){return new Ext.app.Application(a)}},name:"",enableDebugging:false,autoServeStaticFiles:true,services:[],servlets:[],models:[],helpers:[],appFolder:"app",webFolder:"www",socket:null,io:null,ioPort:9998,express:null,expressServer:null,expressPort:9999,mongoose:null,mongoStore:null,mongoConnectUri:"",mime:null,ejs:null,fs:require("fs"),constructor:function(a){Ext.apply(this,a);Ext.apply(this,Ext.getAppConfig());global.App=this;this.startMongoose();this.startExpress();this.startSocketIo();if(Ext.isDefined(a.enableDebugging)){Ext.enableDebugging=a.enableDebugging}Ext.loadClassesByNames(this.helpers,Ext.getAppDir()+"/"+this.appFolder+"/helper");Ext.loadClassesByNames(this.servlets,Ext.getAppDir()+"/"+this.appFolder+"/servlet");Ext.loadClassesByNames(this.services,Ext.getAppDir()+"/"+this.appFolder+"/service");if(Ext.isDefined(a.autoServeStaticFiles)&&a.autoServeStaticFiles===true){this.initDefaultServlets()}this.initSocket();this.launch()},startExpress:function(){Ext.info("Starting Express webserver on port: "+this.expressPort);this.expressServer=this.express.createServer();this.expressServer.use(this.express.methodOverride());this.expressServer.use(this.express.cookieParser());this.expressServer.use(this.express.responseTime());this.expressServer.use(this.express.session({secret:"extode",store:this.mongoStore({url:this.mongoConnectUri})}));this.expressServer.listen(this.expressPort)},startSocketIo:function(){Ext.info("Starting seockt.io on port: "+this.ioPort);this.io=this.io.listen(this.ioPort)},startMongoose:function(){Ext.info("Starting mongoose and connecting to MongoDB. Any command will be buffered until real connect.");if(this.mongoose!==null){this.mongoose.connect(this.mongoConnectUri);Ext.loadClassesByNames(this.models,Ext.getAppDir()+"/"+this.appFolder+"/model")}},initSocket:function(){var b=this.io,a=this;if(!Ext.isDefined(b)||b===null||!Ext.isDefined(b.sockets)||b.sockets===null){throw"No valid socket.io configuration created on first line of App.js. Please recheck to create an instance of var io = require($pathToSocketDotIo).listen($config) there!"}b.sockets.on("connection",function(c){a.socket=c;a.initServices()})},initServices:function(){for(name in global.Services){new Ext.app.Service(global.Services[name])}this.initDefaultServices()},initDefaultServices:function(){new Ext.service.Partial()},initDefaultServlets:function(){var a=this;Ext.servlet({name:"AsyncDelivery",init:function(){this.handle("GET","/Extode/__PartialSupport__.js",function(d,c){var b=Ext.service.Partial.getPartialWebSupportScript();c.writeHead(200,{"Content-Type":"text/javascript"});c.write(b,"binary");c.end();delete b})}});Ext.servlet({name:"Default",init:function(){this.handle("GET","/*",Ext.Servlet.dispatchStaticFiles)}})},getSocket:function(){return this.socket},getExpress:function(){return this.expressServer},getWebFolderPath:function(){return global.App.appFolder+"/"+global.App.webFolder},launch:function(){}});Ext.application=Ext.app.Application.create;